"use strict";(self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[]).push([[6184],{97573:(t,i,s)=>{s.d(i,{EH:()=>a,nB:()=>n,v6:()=>o});var e=s(15045);const n=(t,i=200)=>{let s=0,n=0;const a=1/t,o=t=>t.width/t.height;return[{property:e.ResizeProperty.width,setDimension:i=>(s=o(i)<t?i.width:i.height*t,s),duration:i},{property:e.ResizeProperty.height,setDimension:i=>(n=o(i)<t?i.width*a:i.height,n),duration:i},{property:e.ResizeProperty.top,setDimension:i=>o(i)<t?(i.height-n)/2:0,duration:i},{property:e.ResizeProperty.left,setDimension:i=>o(i)<t?0:(i.width-s)/2,duration:i}]},a=(t=200)=>[{property:e.ResizeProperty.width,setDimension:t=>t.width,duration:t},{property:e.ResizeProperty.height,setDimension:t=>t.height,duration:t},{property:e.ResizeProperty.top,setDimension:()=>0,duration:t},{property:e.ResizeProperty.left,setDimension:()=>0,duration:t}],o=(t,i,s,n=200)=>{const a=[];return void 0!==t&&a.push({property:e.ResizeProperty.width,setDimension:i=>i.width+t,duration:n}),void 0!==i&&a.push({property:e.ResizeProperty.height,setDimension:t=>t.height+i,duration:n}),void 0!==s&&a.push({property:e.ResizeProperty.left,setDimension:()=>s,duration:n}),a}},15045:(t,i,s)=>{s.r(i),s.d(i,{ResizeProperty:()=>e,default:()=>g});var e,n=s(75578),a=s(37105),o=s(73927),r=s(94334),h=s(31093),c=s(52018),d=s(58095),u=s(20599);class p extends c.t{}!function(t){t.left="left",t.top="top",t.width="width",t.height="height"}(e||(e={}));const l={[e.width]:"width",[e.height]:"height",[e.top]:"top",[e.left]:"left"};class g extends n.n{constructor(){super(...arguments),this.name="canvas",this.getNewX=()=>0,this.getNewY=()=>0,this.getNewWidth=t=>t.width,this.getNewHeight=t=>t.height,this.activeTransitions=[],this.activeTransitionMap={left:null,top:null,width:null,height:null},this.onResize=t=>{t.propertyName in e&&(this.resolveActiveTransition(t.propertyName),this._canvas.style.transitionDuration=this.stringifyTransitionDurations())},this.onContainerResize=()=>{this.transitionDurations.left=this.transitionDurations.top=this.transitionDurations.width=this.transitionDurations.height="0s",this._canvas.style.transitionDuration=this.stringifyTransitionDurations(),this.applySize(),this.applyPosition(),this.activeTransitions.forEach(this.resolveActiveTransition.bind(this)),this._canvas.style.transitionDuration=this.stringifyTransitionDurations()}}async init(t,i){if(this.engine=i,!t.container)throw new p;this.container=t.container,this.container.appendChild(t.canvas),this.containerBounds=this.container.getBoundingClientRect(),this._canvas=t.canvas,this._canvas.style.position="absolute",this._canvas.style.left="0",this._canvas.style.top="0",this.transitionDurations={left:"0s",top:"0s",width:"0s",height:"0s",filter:"0.4s"},this._canvas.style.transitionProperty=Object.keys(this.transitionDurations).join(","),this._canvas.style.transitionDuration=this.stringifyTransitionDurations(),this.updateTransitions(),this.bindings.push(i.subscribe(d.P,this.onContainerResize),this.makeTransitionEndSubscription());for(const t of this.bindings)t.renew();this.canvasBounds=this._canvas.getBoundingClientRect(),this.containerBounds=this.container.getBoundingClientRect(),this.data=new a.p(this.canvasBounds.width,this.canvasBounds.height,this._canvas),i.market.register(a.p,this.data),this.cameraData=await this.engine.market.waitForData(u.M)}async resizeCanvas(t){return 0===t.length?[]:(this.cameraData&&!this.cameraData.canTransition()&&await this.cameraData.transition.promise,this.activeTransitions.forEach(this.resolveActiveTransition.bind(this)),t.forEach((t=>{const{property:i,setDimension:s,duration:n=0}=t,a=l[i],o=this._canvas.style[a];switch(i){case e.height:this.setHeight(s,n);break;case e.width:this.setWidth(s,n);break;case e.top:this.setY(s,n);break;case e.left:this.setX(s,n)}if(this._canvas.style[a]!==o&&n>0){const t=new h.i;t.then((()=>{clearTimeout(s)}));const s=setTimeout((()=>{this.resolveActiveTransition(i)}),n+500);this.activeTransitionMap[i]=t,this.activeTransitions.push(i)}})),this.hasActiveTransitions()||(this.canvasBounds=this._canvas.getBoundingClientRect()),this.getTransitionPromise())}makeTransitionEndSubscription(){let t=!1;return{renew:()=>{t||(this.element.addEventListener("transitionend",this.onResize),t=!0)},cancel:()=>{t&&(this.element.removeEventListener("transitionend",this.onResize),t=!1)}}}dispose(t){super.dispose(t)}get element(){return this._canvas}get width(){return this.canvasBounds.width}get height(){return this.canvasBounds.height}get x(){return this.canvasBounds.left}get y(){return this.canvasBounds.top}onUpdate(){const t=this.container.getBoundingClientRect(),i=this.containerHasChanged(t);i&&(this.containerBounds=t,this.updateTransitions()),(i||this.hasActiveTransitions())&&(this.canvasBounds=this._canvas.getBoundingClientRect());const s=this.data.width!==this.width||this.data.height!==this.height,e=this.data.x!==this.x||this.data.y!==this.y;s&&(this.data.width=this.width,this.data.height=this.height,this.data.commit(),this.engine.broadcast(new o.h(this.width,this.height))),e&&(this.data.x=this.x,this.data.y=this.y,this.data.commit(),this.engine.broadcast(new r.C(this.x-this.containerBounds.left,this.y-this.containerBounds.top)))}containerHasChanged(t){return t.left!==this.containerBounds.left||t.top!==this.containerBounds.top||t.width!==this.containerBounds.width||t.height!==this.containerBounds.height}setX(t,i=0){this.getNewX="number"==typeof t?()=>t:t,this.transitionDurations.left=`${i}ms`,this.updateTransitions()}setY(t,i=0){this.getNewY="number"==typeof t?()=>t:t,this.transitionDurations.top=`${i}ms`,this.updateTransitions()}setWidth(t,i=0){this.getNewWidth="number"==typeof t?()=>t:t,this.transitionDurations.width=`${i}ms`,this.updateTransitions()}setHeight(t,i=0){this.getNewHeight="number"==typeof t?()=>t:t,this.transitionDurations.height=`${i}ms`,this.updateTransitions()}screenToCanvasPoint(t,i){return{x:t-this.x,y:i-this.y}}getTransitionPromise(){return Promise.all(this.activeTransitions.map((t=>this.activeTransitionMap[t])).filter((t=>!!t)))}updateTransitions(){this._canvas.style.transitionDuration=this.stringifyTransitionDurations(),this.applySize(),this.applyPosition()}applySize(){this._canvas.style.width=`${this.getNewWidth(this.containerBounds)}px`,this._canvas.style.height=`${this.getNewHeight(this.containerBounds)}px`}applyPosition(){this._canvas.style.left=`${this.getNewX(this.containerBounds)}px`,this._canvas.style.top=`${this.getNewY(this.containerBounds)}px`}stringifyTransitionDurations(){return Object.keys(this.transitionDurations).map((t=>this.transitionDurations[t])).join(",")}resolveActiveTransition(t){this.canvasBounds=this._canvas.getBoundingClientRect();const i=this.activeTransitions.indexOf(t);-1!==i&&this.activeTransitions.splice(i,1);const s=this.activeTransitionMap[t];s&&s.resolve(),this.activeTransitionMap[t]=null,this.transitionDurations[t]="0s"}hasActiveTransitions(){return this.activeTransitions.length>0}}},58095:(t,i,s)=>{s.d(i,{H:()=>a,P:()=>n});var e=s(89103);class n extends e.QB{constructor(t,i){super(),this.width=t,this.height=i}}class a extends e.QB{constructor(t){super(),this.orientation=t}}},83075:(t,i,s)=>{s.d(i,{P:()=>a,m:()=>o});var e=s(6687),n=s(99276);const a=t=>!!t&&t instanceof n.B,o={hasMeshGroup:t=>"object"==typeof t&&!!t&&"meshGroup"in t,hasMeshSubgroup:t=>"object"==typeof t&&!!t&&"meshSubgroup"in t,hasLayerId:t=>"object"==typeof t&&!!t&&"layerId"in t,isRoomMesh:a,isVisibleRoomMesh:t=>a(t)&&(0,e.dW)(t)}},35699:(t,i,s)=>{s.d(i,{X:()=>n});var e=s(55141);class n extends e.u{constructor(t=null){super(),this.payload={cursor:t}}}n.id="SET_MOUSE_CURSOR"},77510:(t,i,s)=>{var e;s.d(i,{b:()=>e}),function(t){t.NONE="none",t.DEFAULT="default",t.MOVE="move",t.MOVE_LF="col-resize",t.MOVE_UD="row-resize",t.XHAIR="crosshair",t.PLUS="cell",t.QUESTION="help",t.NOPE="not-allowed",t.FINGER="pointer",t.TEXT="text",t.TEXT_VERT="vertical-text",t.ZOOM_IN="zoom-in",t.ZOOM_OUT="zoom-in",t.GRAB="grab",t.GRABBING="grabbing",t.ARROW_R="e-resize",t.ARROW_L="w-resize",t.ARROW_U="n-resize",t.ARROW_D="s-resize",t.ARROW_UR="ne-resize",t.ARROW_UL="nw-resize",t.ARROW_DR="se-resize",t.ARROW_DL="sw-resize",t.ARROW_LR="ew-resize",t.ARROW_UD="ns-resize",t.ARROW_URDL="nesw-resize",t.ARROW_ULDR="nwse-resize",t.ROOMBOUNDS_DEFAULT="rbe-default",t.ROOMBOUNDS_MOVING="rbe-moving",t.ROOMBOUNDS_PLACE_NODE="rbe-place-node",t.ROOMBOUNDS_FINISH_ROOM="rbe-finish-room"}(e||(e={}))},3694:(t,i,s)=>{s.d(i,{W:()=>n});var e=s(68909);class n extends e.Mesh{}},95102:(t,i,s)=>{s.d(i,{m:()=>n});var e=s(68909);class n extends e.Mesh{constructor(t,i){super(t,i)}}}}]);