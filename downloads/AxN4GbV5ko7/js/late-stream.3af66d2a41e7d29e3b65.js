"use strict";(self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[]).push([[2276],{12850:(e,t,n)=>{n.r(t),n.d(t,{default:()=>u});var i=n(15564),a=n(90082),r=n(32484),s=n(71687),o=n(72311);const{TEXTURE_SETTINGS:l,clearRaycastHits:h}=r.yJ;const u=async function(e){if(!o.DEBUG_TILEDMESH_SETTINGS.debug)return;const t=await e.getModuleBySymbol(a.ZF),n=await e.getModuleBySymbol(s.GR),r=t.addPanel(i.F.TITLE,i.F.HOTKEYS,{width:350});await t.loadPromise.then((()=>{const e="meshtextures";[{panel:r,header:e,setting:"disableTextureStreamBelowLod",initialValue:()=>-1,onChange:e=>{e>-1&&n.textureQualityMap.limitStreamingBelow(e)},urlParam:!0,rangePrecision:0,range:[-1,7]},{panel:r,header:e,setting:"textureStreamPause",initialValue:()=>l.debugPauseTexStream,onChange:e=>{l.debugPauseTexStream=e},urlParam:!0},{panel:r,header:e,setting:"textureStreamRaycastHits",initialValue:()=>l.debugLOD,onChange:e=>{l.debugLOD=e,e||h()},urlParam:!0},{panel:r,header:e,setting:"debugRTTQuality",initialValue:()=>l.debugRttQuality,onChange:e=>{l.debugRttQuality=e,e||n.setMeshOverlay({})},urlParam:!0},{panel:r,header:e,setting:"debugRTTScores",initialValue:()=>l.debugRttScores,onChange:e=>{l.debugRttScores=e,e||n.setMeshOverlay({})},urlParam:!0}].forEach((e=>t.registerMenuEntry(e)))}))}},82012:(e,t,n)=>{n.r(t),n.d(t,{default:()=>S});var i=n(68909),a=n(84440),r=n(59758),s=n(90082),o=n(26072),l=n(32502),h=n(47299),u=n(50839),d=n(22278),c=n(14240),g=n(90351),m=n(2593),M=n(71687),p=n(82240);Math.PI,Math.PI;function f(e,t){return e+Math.random()*(t-e)}var y=n(81662),x=n(72773);async function S(e){const t=await e.getModuleBySymbol(M.GR),[n,S,T]=await Promise.all([e.market.waitForData(r.o),e.getModuleBySymbol(s.ZF),e.getModuleBySymbol(M.UN)]);await S.loadPromise.then((()=>{let r=null;S.registerMenuEntry({header:"Mesh",setting:"Toggle Trim Bounds",initialValue:()=>!1,onChange:n=>{r||(r=new p.U,e.getModuleBySymbol(M.M7).then((e=>null==r?void 0:r.addToScene(e.getScene()))));for(const e of t.meshTrimData.meshTrimsById.values)r.boxWire(e.id,{color:-1===e.meshGroup?new i.Color("red"):(0,a.Mq)(e.meshGroup)}).update(e.position,e.scale.clone().multiplyScalar(.5),e.rotation).toggle(n)},urlParam:!0}),S.registerButton("Mesh","Toggle visible",(()=>{t.meshes.forEach((e=>{e.modelMesh.visible=!e.modelMesh.visible}))})),S.registerButton("Mesh","Toggle UV debug",(()=>{t.meshes.forEach((e=>{const n=e.renderer.chunkRenderingModeOverride?null:l.f.UV;t.setChunkRenderingMode(n)}))})),S.registerButton("Mesh","Toggle depth",(()=>{t.meshes.forEach((e=>{const n=e.renderer.chunkRenderingModeOverride?null:l.f.Depth;t.setChunkRenderingMode(n)}))})),S.registerButton("Mesh","Toggle transparent",(()=>{t.meshes.forEach((e=>{const n=e.renderer.chunkRenderingModeOverride?null:l.f.Transparent;t.setChunkRenderingMode(n)}))})),S.registerButton("Mesh","Toggle wireframe",(()=>{t.meshes.forEach((e=>{const n=e.renderer.chunkRenderingModeOverride?null:l.f.Wireframe;t.setChunkRenderingMode(n)}))}));let s=!0===Boolean(new URLSearchParams(window.location.search).get("flat"));const b=()=>{t.meshes.forEach((e=>{e.modelMesh instanceof g.f&&e.modelMesh.notifyOnChunksLoaded((e=>{for(const t of e)t.setFlatShading(s)}));for(const t of e.modelMesh.chunks)t.setFlatShading(s)}))};b(),S.registerButton("Mesh","Toggle flat shading",(()=>{s=!s,b()}));const w=(()=>{let e=!1;return(n,r)=>{const s=new i.Vector4(1,1,1,0);var o;e=!e,o=n||e,t.meshes.forEach((e=>{for(const t of e.modelMesh.chunks){const e=r?100*t.id:100*t.meshSubgroup,n=o?(0,a.Zd)(.5,e):s;t.setColorOverlay(n)}}))}})();S.registerButton("Mesh","Highlight Rooms",w),S.registerButton("Mesh","Highlight Chunks",(()=>w(!0,!0))),S.registerButton("Mesh","Random Mesh Trims",(()=>async function(e,t){const n=[],{meshBounds:a}=await t.market.waitForData(d.U),{meshTrimData:r}=await t.getModuleBySymbol(M.GR);for(let t=0;t<e;t++){const e=new c.e(new i.Vector3(f(a.min.x,a.max.x),(a.min.y+a.max.y)/2,f(a.min.z,a.max.z)),new i.Vector3(f(.1,2),a.getSize(new i.Vector3).y+.1,f(.1,2)),(new i.Quaternion).setFromAxisAngle(y.B1.UP,Math.random()*Math.PI),Number.MAX_SAFE_INTEGER,!0,x.Zu,new Date,new Date,void 0,"temp",!0,!0);e.transient=!0,n.push(e)}r.add(...n)}(5,e))),n.onSettingChanged(h.Vp,(e=>{t.meshes.forEach((t=>{const n=T.getFullBounds();for(const i of t.modelMesh.chunks)i.setMaterialsUniform({floorTrimHeight:1-e/100,floorHeightMin:n.min.y,floorHeightMax:n.max.y},!0)}))}));const v=(e,t,i,a,r)=>{S.registerSetting(e,t,i,!0,o.u.NONE,r),n.onSettingChanged(t,a)};v("Wireframe",h._Z,!1,(e=>{t.meshes.forEach((t=>{for(const n of t.modelMesh.chunks)n.setWireframe(e)}))}));const E={[u.d.Wireframe]:{Wireframe:["thickness","wireframeOpacity","stroke","fillEnabled","fill","insideAltColor","dualStroke","secondThickness"],"Wireframe Dashes":["dashEnabled","dashLength","dashAnimate","dashOverlap"],"Wireframe Advanced":["squeeze","squeezeMin","squeezeMax"]}};for(const e in E){const n=m.f.uniforms[e];for(const i in E[e])for(const a of E[e][i])v(i,a,n[a].value,(e=>{t.meshes.forEach((t=>{for(const n of t.modelMesh.chunks)n.setMaterialsUniform({[a]:e})}))}),n[a].range)}}))}},72311:(e,t,n)=>{n.r(t),n.d(t,{DEBUG_TILEDMESH_SETTINGS:()=>y,default:()=>B,tiledMeshDebugMenu:()=>P});var i=n(68909),a=n(90082),r=n(85826),s=n(244),o=n(24241),l=n(75778),h=n(71687),u=n(42120),d=n(84440),c=n(25712),g=n(32484),m=n(47299),M=n(15564);const p=new o.Vy("tiled-mesh"),{TILEDMESH_SETTINGS:f}=g.yJ,y={hideMenu:"1"!==(0,l.P3)("dmenu","0"),debug:"1"===(0,l.P3)("debugTiles","0")||"1"===(0,l.P3)("debug-tiles","0"),statsTiles:!1,statsTileset:!0,statsTextures:!0,statsTextureStream:!0};let x=null;function S(e,t,n){x||(x=document.createElement("div"),x.style.color="#FFFFFF",x.style.fontFamily="Roboto",x.style.fontWeight="300",x.style.fontSize="12px",x.style.position="absolute",x.style.top="85px",x.style.width="500px",x.style.pointerEvents="none",x.style.whiteSpace="pre",x.style.zIndex="99999",x.style.textShadow="0 0 1px black, 0 0 1px black, 0 0 1px black, 0 0 1px black",document.body.appendChild(x));let i="\n\n";i+=function(e){const t=e.threeRenderer.info,n=`three:\n  drawCalls: ${t.render.calls}\n  geometries: ${t.memory.geometries}\n  textures: ${t.memory.textures}\n  triangles: ${t.render.triangles}\n  memory allocated (megs): ${Math.floor(e.estimatedGPUMemoryAllocated()/2**20)}`;return n}(e),i+=y.statsTextureStream?function(e){const t=`\ntextureStreaming:\n  downloadingTiles: ${e.downloadingTiles} / ${e.totalTiles}\n  downloadingTextures: ${e.loadingTextures}\n`,n="  downloaded:\n"+Object.keys(e.totalTextures).map((t=>`    ${t}: ${e.totalTextures[t]} `)).join("\n")+"\n";return t+n}(n):"",t.forEach(((e,t)=>{const n=e.modelMesh;i+=`\n\n<mesh: id:${t}>`,i+=y.statsTileset?function(e,t){var n,i,a;const r=e.tilesRenderer,s=Object.values(null!==(n=r.tileSets)&&void 0!==n?n:[])[0];return`\n  tileset: preset: ${null===(i=null==s?void 0:s.asset.extras)||void 0===i?void 0:i.preset}, depth: ${null===(a=null==s?void 0:s.asset.extras)||void 0===a?void 0:a.depth}, version: ${null==s?void 0:s.asset.tilesetVersion}\n  view: errorTarget: ${t.settings.errorTarget}, maxLOD: ${t.settings.maxLOD}, detail: '${t.detail}'\n`}(n.tileLoader,n):"",i+=y.statsTiles?function(e){const t=e.tilesRenderer,n=t.visibleTiles,i={};n.forEach((e=>{var t;const n=`lod${null===(t=e.extras)||void 0===t?void 0:t.level}`,a=i[n]||0;i[n]=a+1}));const{stats:a,downloadQueue:r,parseQueue:s,lruCache:o}=t,{active:l,downloading:h,inFrustum:u,parsing:d,used:c,visible:g}=a,m=`  tiles:\n    tiles in frustum: ${u}\n    visible: ${g}`+Object.keys(i).sort().map((e=>`\n     ${e} tiles: ${i[e]||0}`)).join()+`\n    downloading gltf: ${h}\n    parsing gltf: ${d}\n    active: ${l}\n    used: ${c}\n    queues:\n      download: ${r.currJobs} running, ${r.items.length} waiting\n      parse: ${s.currJobs} running, ${s.items.length} waiting\n    lruCache: ${o.itemSet.size}\n`;return m}(n.tileLoader):"",i+=`</mesh: id:${t}>`})),x.textContent=i}function T(e,t,n,a,s,o){v&&(e.forEach(((e,n)=>{w.has(e.modelMesh)||(w.add(e.modelMesh),b.push(...function(e,t,n,a){const r=[{panel:e,header:t.tile+": "+n,setting:"maxLOD: "+n,initialValue:()=>a.settings.maxLOD,onChange:e=>{a.settings.maxLOD=e},range:[0,4],rangePrecision:0},{panel:e,header:t.tile+": "+n,setting:"nonMeshMaxLOD: "+n,initialValue:()=>a.settings.nonMeshMaxLOD,onChange:e=>{a.settings.nonMeshMaxLOD=e},range:[0,4],rangePrecision:0},{panel:e,header:t.tile+": "+n,setting:"minLOD: "+n,initialValue:()=>a.settings.minLOD,onChange:e=>{a.settings.minLOD=e},range:[0,4],rangePrecision:0},{panel:e,header:t.tile+": "+n,setting:"errorTarget:"+n,initialValue:()=>a.settings.errorTarget,onChange:e=>{a.settings.errorTarget=e},range:[0,20],rangePrecision:1,urlParam:!0},{panel:e,header:t.tile+": "+n,setting:"disableTileUpdates:"+n,initialValue:()=>a.settings.disableTileUpdates,onChange:e=>{a.settings.disableTileUpdates=e}},{panel:e,header:t.tile+": "+n,setting:"disposeModel: "+n,initialValue:()=>a.settings.disposeModel,onChange:e=>{a.settings.disposeModel=e}},{panel:e,header:t.tile+": "+n,setting:"pos on z axis: "+n,initialValue:()=>0,onChange:e=>{a.position.copy(new i.Vector3(0,0,e)),a.updateMatrixWorld(!0)},range:[-100,100],rangePrecision:0}];return r}(t,a,n,e.modelMesh)),b.push(...function(e,t,n,i,a,s){const o=i.tileLoader,l=C(o,s,((e,t)=>e.setWireframe(t))),h=function(e,t){const n={scale:1},i=(t,i)=>{if(!t)return;const a=e.container.tilesByChunkId.get(t.id),r=(null==a?void 0:a.__error)||1e-4,s=t.lod!==f.maxLOD&&r>f.errorTarget?1:.5,o=Math.max(0,Math.min(1,1-n.scale/r)),l=i?z(t.lod,o,s):null;t.setColorOverlay(l)},a=C(e,t,i),s=(0,r.f)((()=>a.colorize(e.container.chunks)));return{toggle:e=>{e?s.renew():s.cancel(),a.toggle(e)},colorize:a.colorize,subscription:s,config:n}}(o,s),u=C(o,s,((e,t)=>{e.setColorOverlay(t?z(e.lod,1,.5):null)})),g=C(o,s,((e,t)=>{e.setColorOverlay(t?(0,d.Zd)(.5,e.id||0):null)})),m=C(o,s,((e,t)=>{var n;const i=o.container.tilesByChunkId.get(e.id);e.setColorOverlay(t?(0,d.Zd)(.5,(0,c.s5)((null===(n=null==i?void 0:i.content)||void 0===n?void 0:n.uri)||"missing")||0):null)})),M=C(o,s,((e,t)=>{e.setColorOverlay(t?(0,d.Zd)(.5,(e.meshGroup<<16)+e.meshSubgroup||0):null)})),y=C(o,s,((e,t)=>{e.setColorOverlay(t?(0,d.Zd)(.5,e.meshSubgroup||0):null)})),x=C(o,s,((e,t)=>{e.setColorOverlay(t?(0,d.Zd)(.5,e.meshGroup||0):null)})),S=C(o,s,((e,t)=>{e.setColorOverlay(t?(0,d.Zd)(.5,(0,c.s5)(e.textureName)||0):null)})),T=C(o,s,((e,t)=>{const n=o.container.tilesByChunkId.get(e.id);e.setColorOverlay(t?(0,d.Zd)(.5,(null==n?void 0:n.geometricError)||0):null)})),b=a.slots,w=i.textureQualityMap,v=C(o,s,((e,t)=>{const n=b.find((t=>t.textureName===e.textureName));if(n){const i=n.loading?1:n.quality>w.min(e.lod)?.7:.3,a=w.maxTexelSize/w.get(n.quality).texelSize;e.setColorOverlay(t?z(e.lod,a,i):null)}})),E=(0,r.f)((()=>v.colorize(o.container.chunks)));let P="none";const V={none:void 0,byError:h,byGeometricError:T,byTile:m,bySubgroup:y,byMeshgroup:x,bySubAndMeshgroup:M,byTexture:S,byStreamedTextures:{subscription:E,toggle:e=>{e?E.renew():E.cancel(),e&&p.info("colorize=byStreamedTextures solid color: loading, dark color: streamed, light color: basis"),v.toggle(e)}},byChunk:g,byLod:u},B=[{panel:e,header:`${t.viz}: ${n}`,setting:"disableTileUpdates:"+n,initialValue:()=>i.settings.disableTileUpdates,onChange:e=>{i.settings.disableTileUpdates=e},urlParam:!0},{panel:e,header:`${t.viz}: ${n}`,setting:"wireframe:"+n,initialValue:()=>!1,onChange:l.toggle,urlParam:!0},{panel:e,header:`${t.viz}: ${n}`,setting:"colorize:"+n,initialValue:()=>"none",onChange:e=>{var t,n;null===(t=V[P])||void 0===t||t.toggle(!1),null===(n=V[e])||void 0===n||n.toggle(!0),P=e},options:Object.keys(V),urlParam:!0},{panel:e,header:`${t.viz}: ${n}`,setting:"colorizeByErrorScale:"+n,initialValue:()=>1,onChange:e=>{h.config.scale=e},range:[0,6],rangePrecision:3,urlParam:!0}];return B}(t,a,n,e.modelMesh,s,o)))})),b.length&&(b.forEach((e=>n.registerMenuEntry(e))),b.length=0))}const b=[],w=new Set;let v=!1,E=null;async function P(e){if(!y.debug)return;const t=await e.getModuleBySymbol(a.ZF),n=await e.getModuleBySymbol(h.mL),i=await e.getModuleBySymbol(h.M7),r=i.getScene(),s=await e.getModuleBySymbol(h.GR);await s.firstMeshLoadPromise,await(0,u.c)(100);const o=s.meshes,l=s.meshTextureLoader,d=t.tryGetSetting(m.sz,!1),c=t.addPanel(M.F.TITLE,M.F.HOTKEYS,{width:350}),g={viz:"visualize",stats:"stats",tile:"tileset",log:"log"};function x(){E||(E=setInterval((()=>{S(i,o,l),T(o,c,t,g,l,e)}),150))}const b=[{panel:c,header:g.stats,setting:"tilesetStatsOverlay",initialValue:()=>y.statsTileset,onChange:e=>{y.statsTileset=e,e&&x()},urlParam:!0},{panel:c,header:g.stats,setting:"tileStatsOverlay",initialValue:()=>y.statsTiles,onChange:e=>{y.statsTiles=e,e&&x()},urlParam:!0},{panel:c,header:g.stats,setting:"textureStatsOverlay",initialValue:()=>y.statsTextures,onChange:e=>{y.statsTextures=e,e&&x()},urlParam:!0},{panel:c,header:g.stats,setting:"textureStreamingOverlay",initialValue:()=>y.statsTextureStream,onChange:e=>{y.statsTextureStream=e,e&&x()},urlParam:!0}],w=[{panel:c,header:g.log,buttonName:"Log: App State",callback:()=>{p.warn(o),p.warn(n),p.warn(r),p.warn(t)}}];d&&(y.hideMenu||await(0,u.c)(1e3).then((()=>{t.getSettingsGui().loadGuiPackage().then((()=>{t.getSettingsGui().toggle(t.getMainPanelId()),t.getSettingsGui().toggle(t.getMainPanelId())}))})),await(0,u.c)(16),v||(await(0,u.c)(16),v=!0,function(e,t,n,i){const a=[{panel:e,header:t.tile,setting:"smallMeshThreshold",initialValue:()=>f.smallMeshThreshold,onChange:e=>{f.smallMeshThreshold=e,i.forEach((t=>{t.modelMesh.settings.smallMeshThreshold=e}))},range:[0,100],rangePrecision:1,urlParam:!0},{panel:e,header:t.tile,setting:"smallMeshErrorMultiplier",initialValue:()=>f.smallMeshErrorMultiplier,onChange:e=>{f.smallMeshErrorMultiplier=e,i.forEach((t=>{t.modelMesh.settings.smallMeshErrorMultiplier=e}))},range:[.01,2],rangePrecision:2,urlParam:!0},{panel:e,header:t.tile,setting:"displayActiveTiles",initialValue:()=>f.displayActiveTiles,onChange:e=>{f.displayActiveTiles=e,i.forEach((t=>{t.modelMesh.settings.displayActiveTiles=e}))},urlParam:!0},{panel:e,header:t.tile,setting:"loadSiblings",initialValue:()=>f.loadSiblings,onChange:e=>{f.loadSiblings=e,i.forEach((t=>{t.modelMesh.settings.loadSiblings=e}))},urlParam:!0},{panel:e,header:t.tile,setting:"autoDisableRendererCulling",initialValue:()=>f.autoDisableRendererCulling,onChange:e=>{f.autoDisableRendererCulling=e,i.forEach((t=>{t.modelMesh.settings.autoDisableRendererCulling=e}))},urlParam:!0},{panel:e,header:t.tile,setting:"stopAtEmptyTiles",initialValue:()=>f.stopAtEmptyTiles,onChange:e=>{f.stopAtEmptyTiles=e,i.forEach((t=>{t.modelMesh.settings.stopAtEmptyTiles=e}))},urlParam:!0},{panel:e,header:t.tile,setting:"limitMemoryUsage",initialValue:()=>f.limitMemoryUsage,onChange:e=>{f.limitMemoryUsage=e,i.forEach((t=>{t.modelMesh.settings.limitMemoryUsage=e}))},urlParam:!0},{panel:e,header:t.tile,setting:"allocatedMegsBeforeLimitingLod",initialValue:()=>f.allocatedMegsBeforeLimitingLod,onChange:e=>{f.allocatedMegsBeforeLimitingLod=e,i.forEach((t=>{t.modelMesh.settings.allocatedMegsBeforeLimitingLod=e}))},urlParam:!0,range:[100,1e3]},{panel:e,header:t.tile,setting:"lruMinExtraTiles",initialValue:()=>f.lruMinExtraTiles,onChange:e=>{f.lruMinExtraTiles=e,i.forEach((t=>{t.modelMesh.settings.lruMinExtraTiles=e}))},urlParam:!0,range:[0,2e3]},{panel:e,header:t.tile,setting:"lruMaxTiles",initialValue:()=>f.lruMaxTiles,onChange:e=>{f.lruMaxTiles=e,i.forEach((t=>{t.modelMesh.settings.lruMaxTiles=e}))},urlParam:!0,range:[0,2e3]},{panel:e,header:t.tile,setting:"lruUnloadPercent",initialValue:()=>f.lruUnloadPercent,onChange:e=>{f.lruUnloadPercent=e,i.forEach((t=>{t.modelMesh.settings.lruUnloadPercent=e}))},urlParam:!0,range:[0,1]},{panel:e,header:"Priority",setting:"errorMultiplierRaycastOcclusion",initialValue:()=>f.errorMultiplierRaycastOcclusion,onChange:e=>{f.errorMultiplierRaycastOcclusion=e,i.forEach((t=>{t.modelMesh.settings.errorMultiplierRaycastOcclusion=e}))},range:[.001,1],rangePrecision:2},{panel:e,header:"Priority",setting:"errorMultiplierHiddenFloors",initialValue:()=>f.errorMultiplierHiddenFloors,onChange:e=>{f.errorMultiplierHiddenFloors=e,i.forEach((t=>{t.modelMesh.settings.errorMultiplierHiddenFloors=e}))},range:[.001,1],rangePrecision:2}];return a}(c,g,0,o).forEach((e=>t.registerMenuEntry(e))),b.forEach((e=>t.registerMenuEntry(e))),w.forEach((e=>t.registerMenuButton(e)))))}function C(e,t,n){let i=!1;const a=e=>{t.after(s.R.End).then((()=>{e.forEach((e=>{e&&n(e,i)}))}))},r=e.notifyOnChunksLoaded(a);r.cancel();return{toggle:t=>{t?r.renew():r.cancel(),t!==i&&(i=t,a([...e.container.chunks]))},colorize:a,subscription:r}}const V={0:new i.Vector4(1,0,0,1),1:new i.Vector4(0,1,0,1),2:new i.Vector4(0,0,1,1),3:new i.Vector4(1,1,1,1),4:new i.Vector4(1,0,1,1),5:new i.Vector4(0,1,1,1),6:new i.Vector4(1,1,0,1),7:new i.Vector4(0,0,0,1)};function z(e,t,n){var a,r;const s=null!==(r=null===(a=V[e])||void 0===a?void 0:a.clone())&&void 0!==r?r:new i.Vector4;return s.multiplyScalar(t),s.setW(n),s}const B=P},15564:(e,t,n)=>{n.d(t,{F:()=>i});const i={TITLE:"streamed-mesh (T)",HOTKEYS:[n(71397).D.T]}},32484:(e,t,n)=>{n.d(t,{yJ:()=>s});var i=n(80112),a=n(47299),r=n(14971);const s={TEXTURE_SETTINGS:a.Ay,TILEDMESH_SETTINGS:i.W,clearRaycastHits:r.Jn}},14240:(e,t,n)=>{n.d(t,{e:()=>h});var i=n(68909),a=n(85616),r=n(35535),s=n(30443),o=n(45205);const l=new i.Vector3;class h extends a.v{constructor(e,t,n,a,r,s,l=new Date,h=new Date,u,d,c,g){super(),this.position=e,this.scale=t,this.rotation=n,this.enabled=r,this.meshGroup=s,this.created=l,this.modified=h,this.discardContents=!0,this.activeInPanoMode=!0,this.transient=!1,this._rotationMatrix=new i.Matrix4,this._matrix=new i.Matrix4,this.id=u||`${this.meshGroup}`+(0,o.D)(11),this.index=a,this.name=d,this.discardContents=void 0===c||c,this.activeInPanoMode=void 0===g||g}get sid(){return this.id}isPointTrimmed(e,t){return!!this.enabled&&(!(t&&!this.activeInPanoMode)&&(this.discardContents?this.isPointInside(e):!this.isPointInside(e)))}getTransformationMatrix(e){return(e=e||new i.Matrix4).compose(this.position,this.rotation,this.scale),e}getInverseTransformationMatrix(e){return(e=this.getTransformationMatrix(e)).invert(),e}isPointInside(e){this.getInverseTransformationMatrix(this._matrix);const t=l.copy(e).applyMatrix4(this._matrix);return t.x<.5&&t.x>-.5&&t.y<.5&&t.y>-.5&&t.z<.5&&t.z>-.5}updateRotationMatrix(){const e=this.rotation,t=this.rotation.clone().set(e.x,e.y,e.z,-e.w);this._rotationMatrix.makeRotationFromQuaternion(t.normalize())}get rotationMatrix(){return this.updateRotationMatrix(),this._rotationMatrix}static getUnitAABB(){return new i.Box3(new i.Vector3(-.5,-.5,-.5),new i.Vector3(.5,.5,.5))}getContainingAABB(){const e=h.getUnitAABB(),t=(0,s.jF)(e),n=this.getTransformationMatrix();return(0,s.nD)(t,e,n)}getOBB(){const e=(new i.Matrix4).makeRotationFromQuaternion(this.rotation),t=(new i.Matrix3).setFromMatrix4(e);return new r.OBB(this.position,this.scale.clone().multiplyScalar(.5),t)}}},35535:(e,t,n)=>{n.r(t),n.d(t,{OBB:()=>S});var i=n(68909);const a={c:null,u:[new i.Vector3,new i.Vector3,new i.Vector3],e:[]},r={c:null,u:[new i.Vector3,new i.Vector3,new i.Vector3],e:[]},s=[[],[],[]],o=[[],[],[]],l=[],h=new i.Vector3,u=new i.Vector3,d=new i.Vector3,c=new i.Vector3,g=new i.Vector3,m=new i.Vector3,M=new i.Matrix3,p=new i.Box3,f=new i.Matrix4,y=new i.Matrix4,x=new i.Ray;class S{constructor(e=new i.Vector3,t=new i.Vector3,n=new i.Matrix3){this.center=e,this.halfSize=t,this.rotation=n}set(e,t,n){return this.center=e,this.halfSize=t,this.rotation=n,this}copy(e){return this.center.copy(e.center),this.halfSize.copy(e.halfSize),this.rotation.copy(e.rotation),this}clone(){return(new this.constructor).copy(this)}getSize(e){return e.copy(this.halfSize).multiplyScalar(2)}clampPoint(e,t){const n=this.halfSize;c.subVectors(e,this.center),this.rotation.extractBasis(h,u,d),t.copy(this.center);const a=i.MathUtils.clamp(c.dot(h),-n.x,n.x);t.add(h.multiplyScalar(a));const r=i.MathUtils.clamp(c.dot(u),-n.y,n.y);t.add(u.multiplyScalar(r));const s=i.MathUtils.clamp(c.dot(d),-n.z,n.z);return t.add(d.multiplyScalar(s)),t}containsPoint(e){return c.subVectors(e,this.center),this.rotation.extractBasis(h,u,d),Math.abs(c.dot(h))<=this.halfSize.x&&Math.abs(c.dot(u))<=this.halfSize.y&&Math.abs(c.dot(d))<=this.halfSize.z}intersectsBox3(e){return this.intersectsOBB(T.fromBox3(e))}intersectsSphere(e){return this.clampPoint(e.center,m),m.distanceToSquared(e.center)<=e.radius*e.radius}intersectsOBB(e,t=Number.EPSILON){a.c=this.center,a.e[0]=this.halfSize.x,a.e[1]=this.halfSize.y,a.e[2]=this.halfSize.z,this.rotation.extractBasis(a.u[0],a.u[1],a.u[2]),r.c=e.center,r.e[0]=e.halfSize.x,r.e[1]=e.halfSize.y,r.e[2]=e.halfSize.z,e.rotation.extractBasis(r.u[0],r.u[1],r.u[2]);for(let e=0;e<3;e++)for(let t=0;t<3;t++)s[e][t]=a.u[e].dot(r.u[t]);c.subVectors(r.c,a.c),l[0]=c.dot(a.u[0]),l[1]=c.dot(a.u[1]),l[2]=c.dot(a.u[2]);for(let e=0;e<3;e++)for(let n=0;n<3;n++)o[e][n]=Math.abs(s[e][n])+t;let n,i;for(let e=0;e<3;e++)if(n=a.e[e],i=r.e[0]*o[e][0]+r.e[1]*o[e][1]+r.e[2]*o[e][2],Math.abs(l[e])>n+i)return!1;for(let e=0;e<3;e++)if(n=a.e[0]*o[0][e]+a.e[1]*o[1][e]+a.e[2]*o[2][e],i=r.e[e],Math.abs(l[0]*s[0][e]+l[1]*s[1][e]+l[2]*s[2][e])>n+i)return!1;return n=a.e[1]*o[2][0]+a.e[2]*o[1][0],i=r.e[1]*o[0][2]+r.e[2]*o[0][1],!(Math.abs(l[2]*s[1][0]-l[1]*s[2][0])>n+i)&&(n=a.e[1]*o[2][1]+a.e[2]*o[1][1],i=r.e[0]*o[0][2]+r.e[2]*o[0][0],!(Math.abs(l[2]*s[1][1]-l[1]*s[2][1])>n+i)&&(n=a.e[1]*o[2][2]+a.e[2]*o[1][2],i=r.e[0]*o[0][1]+r.e[1]*o[0][0],!(Math.abs(l[2]*s[1][2]-l[1]*s[2][2])>n+i)&&(n=a.e[0]*o[2][0]+a.e[2]*o[0][0],i=r.e[1]*o[1][2]+r.e[2]*o[1][1],!(Math.abs(l[0]*s[2][0]-l[2]*s[0][0])>n+i)&&(n=a.e[0]*o[2][1]+a.e[2]*o[0][1],i=r.e[0]*o[1][2]+r.e[2]*o[1][0],!(Math.abs(l[0]*s[2][1]-l[2]*s[0][1])>n+i)&&(n=a.e[0]*o[2][2]+a.e[2]*o[0][2],i=r.e[0]*o[1][1]+r.e[1]*o[1][0],!(Math.abs(l[0]*s[2][2]-l[2]*s[0][2])>n+i)&&(n=a.e[0]*o[1][0]+a.e[1]*o[0][0],i=r.e[1]*o[2][2]+r.e[2]*o[2][1],!(Math.abs(l[1]*s[0][0]-l[0]*s[1][0])>n+i)&&(n=a.e[0]*o[1][1]+a.e[1]*o[0][1],i=r.e[0]*o[2][2]+r.e[2]*o[2][0],!(Math.abs(l[1]*s[0][1]-l[0]*s[1][1])>n+i)&&(n=a.e[0]*o[1][2]+a.e[1]*o[0][2],i=r.e[0]*o[2][1]+r.e[1]*o[2][0],!(Math.abs(l[1]*s[0][2]-l[0]*s[1][2])>n+i)))))))))}intersectsPlane(e){this.rotation.extractBasis(h,u,d);const t=this.halfSize.x*Math.abs(e.normal.dot(h))+this.halfSize.y*Math.abs(e.normal.dot(u))+this.halfSize.z*Math.abs(e.normal.dot(d)),n=e.normal.dot(this.center)-e.constant;return Math.abs(n)<=t}intersectRay(e,t){return this.getSize(g),p.setFromCenterAndSize(c.set(0,0,0),g),f.setFromMatrix3(this.rotation),f.setPosition(this.center),y.copy(f).invert(),x.copy(e).applyMatrix4(y),x.intersectBox(p,t)?t.applyMatrix4(f):null}intersectsRay(e){return null!==this.intersectRay(e,c)}fromBox3(e){return e.getCenter(this.center),e.getSize(this.halfSize).multiplyScalar(.5),this.rotation.identity(),this}equals(e){return e.center.equals(this.center)&&e.halfSize.equals(this.halfSize)&&e.rotation.equals(this.rotation)}applyMatrix4(e){const t=e.elements;let n=c.set(t[0],t[1],t[2]).length();const i=c.set(t[4],t[5],t[6]).length(),a=c.set(t[8],t[9],t[10]).length();e.determinant()<0&&(n=-n),M.setFromMatrix4(e);const r=1/n,s=1/i,o=1/a;return M.elements[0]*=r,M.elements[1]*=r,M.elements[2]*=r,M.elements[3]*=s,M.elements[4]*=s,M.elements[5]*=s,M.elements[6]*=o,M.elements[7]*=o,M.elements[8]*=o,this.rotation.multiply(M),this.halfSize.x*=n,this.halfSize.y*=i,this.halfSize.z*=a,c.setFromMatrixPosition(e),this.center.add(c),this}}const T=new S}}]);